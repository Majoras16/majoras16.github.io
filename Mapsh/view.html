<!doctype html>
<html>
  <head>
    <title>Redirecting to your map app...</title>
    <style>
a {
 display: none;
 background: white;
 border: none;
 border-radius: 50px;
 padding: 15px;
 box-shadow: 0px 5px 10px rgb(150,150,150);
}
   </style>
  </head>
  <body>
   <a>Lancer l'application</a>
  </body>
  <script>
let usp = new URLSearchParams(location.search);

function lon2tile(lon,zoom){return (Math.floor((lon+180)/360*Math.pow(2,zoom)));}
function lat2tile(lat,zoom){return (Math.floor((1-Math.log(Math.tan(lat*Math.PI/180)+1/Math.cos(lat*Math.PI/180))/Math.PI)/2*Math.pow(2,zoom)));}

function setA(s) {
 let a = document.querySelectorAll("a")[0];
 a.href = s;
 a.style.display = "inline-block";
 if(usp.has("l")) {
  let l = atob(usp.get("l").replace(/_/g,"=")).split(";");
  document.body.innerHTML = "<img src='https://tile.openstreetmap.org/17/"+lon2tile(l[0],17)+"/"+lat2tile(l[1],17)+".png' />";
 }
}

if(usp.has("a")) {
 let a = usp.get("a");
 let n = (navigator.platform || "Unknown");
 if(n === "iPhone") {
  setA("https://maps.apple.com/?address="+a);
 } else if(n === "Android") {
  setA("geo:0,0?q="+a);
 } else if(n === "Win32") {
  setA("bingmaps:?q="+a+"&sty=a");
 } else {
  alert("Syst\u00e0me inconnu");
 }
} else if(usp.has("l")) {
 let l = atob(usp.get("l").replace(/_/g,"=")).split(";");
 let n = (navigator.platform || "Unknown");
 if(n === "iPhone") {
  setA("https://maps.apple.com/?address="+l[0]+","+l[1]);
 } else if(n === "Android") {
  setA("geo:0,0?q="+l[0]+","+l[1]);
 } else if(n === "Win32") {
  setA("bingmaps:?collection=point."+l[0]+"_"+l[1]+"&lvl=20&sty=a");
 } else {
  alert("Syst\u00e0me inconnu");
 }
}
  </script>
</html>
